from core_module.transfer.baidu import BaiduTransferDriver
from core_module.transfer.aliyun import AliTransferDriver
from core_module.supervisor import TranscrapeSupervisor
from utils.async_io import async_run

# 本案例展示 从明文授权信息创建持久化数据
# 需要在async环境下实例化 TranscrapeSupervisor 以及各类接口驱动
async def async_main():
    # 授权信息，仅第一次启动需要，后续只需要读取持久化数据
    ali_auth = 'a******************************b'
    baidu_cookies = 'XFI=************************************; XFCS=****************************************************************; XFT=********************************************; BIDUPSID=********************************; PSTM=**********; BAIDUID=********************************:FG=1; PANWEB=1; secu=1; H_WISE_SIDS=**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************; H_WISE_SIDS_BFESS=**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************; BDUSS=X***********************************************************************************************************************************************************************************************; BDUSS_BFESS=************************************************************************************************************************************************************************************************; ***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************'

    # 流程控制器
    async with TranscrapeSupervisor(
            BaiduTransferDriver(baidu_cookies),  # 度盘转存驱动，传入授权cookies
            AliTransferDriver(ali_auth)  # 阿里盘转存驱动，传入refresh_token（持久有效）
                                         # 或access_token（有效期2小时，需要以kwarg方式传入）
    ) as supervisor:
        supervisor.persistent_dump('persistent_data')  # 保存持久化数据（token缓存、授权信息等）


if __name__ == '__main__':
    async_run(async_main())
