from core_module.scrape.ncar import NcarScrapeDriver, NcarTarget, NcarClouds, NcarScrapeTask, NcarCaptions
from core_module.transfer.baidu import BaiduTransferDriver
from core_module.transfer.aliyun import AliTransferDriver
from core_module.supervisor import TranscrapeSupervisor
from utils.async_io import async_run


async def async_main():
    tasks = [
        NcarScrapeTask(
            'https://mcar.vip/forum.php?mod=viewthread&tid=35942',
            NcarTarget(NcarCaptions.chinese, NcarClouds.baidu, '/test/中文/The Neighborhood Season 5 (2022)'),
            NcarTarget(NcarCaptions.raw, NcarClouds.ali, '/test/raw/The Neighborhood Season 5 (2022)')
        ),
        NcarScrapeTask(
            'https://mcar.vip/forum.php?mod=viewthread&tid=36286',
            NcarTarget(NcarCaptions.chinese, NcarClouds.baidu, '/test/中文/Succession Season 4 (2023)'),
            NcarTarget(NcarCaptions.raw, NcarClouds.ali, '/test/raw/Succession Season 4 (2023)')
        )
    ]

    ali_auth = 'eyJhbGciOiJS******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************IVGhk57QwwKNaMgX5g'
    baidu_cookies = 'XFI=************************************; XFCS=****************************************************************; XFT=********************************************; BIDUPSID=********************************; PSTM=**********; BAIDUID=********************************:FG=1; PANWEB=1; secu=1; H_WISE_SIDS=**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************; H_WISE_SIDS_BFESS=**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************; BDUSS=X***********************************************************************************************************************************************************************************************; BDUSS_BFESS=************************************************************************************************************************************************************************************************; ***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************'

    async with TranscrapeSupervisor(NcarScrapeDriver(),
                                    BaiduTransferDriver(baidu_cookies),
                                    AliTransferDriver(ali_auth)
                                    ) as supervisor:
        supervisor.submit(*tasks)
        await supervisor.wait_for_all()


if __name__ == '__main__':
    async_run(async_main())
